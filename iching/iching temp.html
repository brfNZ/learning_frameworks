<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Ching Oracle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .book-cover {
            width: 100px;
            height: auto;
            object-fit: cover;
            margin: 0 auto 8px;
        }
        
        .i-ching-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .i-ching-table thead {
            background: #d1d5db;
        }
        
        .i-ching-table th {
            padding: 1rem;
            font-weight: bold;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .i-ching-table th:nth-child(1) { 
            text-align: left; 
            white-space: normal;
            width: 70px;
        }
        .i-ching-table th:nth-child(2) { text-align: center; white-space: nowrap; }
        .i-ching-table th:nth-child(3) { text-align: left; white-space: nowrap; }
        .i-ching-table th:nth-child(n+4) { text-align: center; width: 128px; }
        
        .i-ching-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .i-ching-table td:nth-child(1) { padding: 0.75rem 0.5rem; white-space: nowrap; text-align: center; }
        .i-ching-table td:nth-child(2) { padding: 0.75rem 0.5rem; font-size: 3.00rem; white-space: nowrap; text-align: center; }
        .i-ching-table td:nth-child(3) { padding: 0.75rem 0.75rem; white-space: nowrap; }
        .i-ching-table th:nth-child(n+4) { 
            text-align: center; 
            width: 128px;
            font-size: 0.75rem;  /* Slightly larger for readability */
        }
        
        .i-ching-table tbody tr:nth-child(even) {
            background: #f3f4f6;
        }
        
        .i-ching-table tbody tr:hover {
            background: #f9fafb;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-6">
    <div class="max-w-full mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">I Ching Oracle</h1>
            <p class="text-lg text-gray-600">The Book of Changes - 64 Hexagrams</p>
        </div>

        <!-- Search Input -->
        <div class="mb-4">
            <input type="text" id="searchInput" placeholder="Search by name or hex number..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>

        <!-- Table Container -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden" id="tableContainer">
            <div class="overflow-x-auto">
                <table class="i-ching-table">
                    <thead>
                        <tr>
                            <th>Gua<br>number</th>
                            <th>Symbol</th>
                            <th>Name</th>
                            <th><img src="covers/iching.png" alt="The Book of Changes" class="book-cover">The Book of Changes</th>
                            <th><img src="covers/guide-iching.png" alt="A Guide to the I Ching" class="book-cover">A Guide to the I Ching</th>
                            <th><img src="covers/complete-iching.png" alt="The Complete I Ching.10th Ed" class="book-cover">The Complete I Ching.10th Ed</th>
                            <th><img src="covers/authentic-iching.png" alt="The Authentic I Ching" class="book-cover">The Authentic I Ching</th>
                            <th><img src="covers/iching-pt1.png" alt="I Ching Wilhelm Pt.1" class="book-cover">I Ching Pt.1</th>
                            <th><img src="covers/iching-pt2.png" alt="I Ching Wilhelm Pt.2" class="book-cover">I Ching Pt.2</th>
                            <th><img src="covers/taoist-iching.png" alt="Taoist I Ching" class="book-cover">Taoist I Ching</th>
                            <th><img src="covers/tao-organisation.png" alt="Tao of Organisation" class="book-cover">Tao of Organisation</th>
                            <th><img src="covers/astrology-iching.png" alt="Astrology of I Ching" class="book-cover">Astrology of I Ching</th>
                            <th><img src="covers/book10.png" alt="Book 10" class="book-cover">Book 10</th>
                            <th><img src="covers/book11.png" alt="Book 11" class="book-cover">Book 11</th>
                            <th><img src="covers/book12.png" alt="Book 12" class="book-cover">Book 12</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Rows generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer with Journal Section -->
    <footer class="mt-8 bg-gray-100 p-6 rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Divination Journal</h2>
        <form onsubmit="addEntry(event)" class="mb-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="question" placeholder="Enter your question..." class="p-2 border rounded">
                <input type="text" id="hex" placeholder="Enter hexagram (e.g., 1: The Creative)" class="p-2 border rounded">
            </div>
            <textarea id="notes" placeholder="Add notes or insights..." class="w-full p-2 border rounded mt-2" rows="3"></textarea>
            <button type="submit" class="mt-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Log Entry</button>
        </form>
        <button onclick="exportJournal()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">Export Journal to CSV</button>
        <div id="journalOutput" class="mt-4"></div>
    </footer>

    <script>
        // ========== DATA SECTION (Optimized: Single books object for easy maintenance) ==========
        
        const hexagrams = ['䷀','䷁','䷂','䷃','䷄','䷅','䷆','䷇','䷈','䷉','䷊','䷋','䷌','䷍','䷎','䷏','䷐','䷑','䷒','䷓','䷔','䷕','䷖','䷗','䷘','䷙','䷚','䷛','䷜','䷝','䷞','䷟','䷠','䷡','䷢','䷣','䷤','䷥','䷦','䷧','䨸','䷩','䷪','䷫','䷬','䷭','䷮','䷯','䷰','䷱','䷲','䷳','䷴','䷵','䷶','䷷','䷸','䷹','䷺','䷻','䷼','䷽','䷾','䷿'];
        
        const names = ['The Creative','The Receptive','Difficulty at the Beginning','Youthful Folly','Waiting','Conflict','The Army','Holding Together','The Taming Power of the Small','Treading','Peace','Standstill','Fellowship with Men','Possession in Great Measure','Modesty','Enthusiasm','Following','Work on What Has Been Spoiled','Approach','Contemplation','Biting Through','Grace','Splitting Apart','Return','Innocence','The Taming Power of the Great','The Corners of the Mouth','Preponderance of the Great','The Abysmal','The Clinging','Influence','Duration','Retreat','The Power of the Great','Progress','Darkening of the Light','The Family','Opposition','Obstruction','Deliverance','Decrease','Increase','Break-through','Coming to Meet','Gathering Together','Pushing Upward','Oppression','The Well','Revolution','The Cauldron','The Arousing','Keeping Still','Development','The Marrying Maiden','Abundance','The Wanderer','The Gentle','The Joyous','Dispersion','Limitation','Inner Truth','Preponderance of the Small','After Completion','Before Completion'];

        // Book data arrays (64 entries each, padded with "N/A" where missing)
        const book1 = [3,7,11,14,17,20,23,25,28,30,32,36,38,41,43,46,48,51,54,56,59,61,63,66,68,70,73,76,79,82,85,91,93,96,100,103,108,111,113,116,119,123,126,131,135,140,142,145,149,153,156,160,162,165,170,172,175,177,179,185,189,198,200,209, 'N/A', 'N/A', 'N/A'];
        const book2 = [6,7,8,9,11,12,13,14,16,17,18,19,20,22,23,24,26,27,28,29,30,32,33,34,35,37,38,39,41,42,44,45,47,48,50,51,52,53,54,55,56,57,58,60,61,63,64,65,66,67,68,70,72,73,75,76,77,78,80,81,82,84,85,86, 'N/A', 'N/A', 'N/A'];
        const book3 = [53,71,89,99,107,115,122,129,136,144,151,160,168,177,184,192,200,208,215,222,229,236,243,249,257,264,271,279,287,295,303,311,319,326,333,339,346,353,360,367,374,381,388,395,402,409,416,424,431,439,447,454,461,468,475,482,488,495,501,507,513,520,529,537, 'N/A', 'N/A', 'N/A'];
        const book4 = [50,63,71,73,76,78,80,83,85,87,89,92,94,96,98,100,103,105,107,110,112,115,117,120,122,125,127,130,132,134,137,139,141,144,146,148,150,153,156,158,161,163,166,168,171,173,176,178,181,183,186,189,191,193,196,198,200,203,205,207,210,212,215,217, 'N/A', 'N/A', 'N/A'];
        const book5 = [22,25,28,30,32,34,35,37,40,42,44,46,48,49,51,53,55,57,59,61,63,65,66,68,70,71,73,75,77,79,81,83,84,86,88,89,91,93,95,97,99,101,103,105,107,109,110,112,114,116,118,120,122,124,126,128,130,131,133,135,137,139,142,144, 'N/A', 'N/A', 'N/A'];
        const book6 = [2,10,17,20,23,25,28,30,33,35,38,41,43,46,48,51,53,56,58,60,62,65,67,69,71,74,76,79,82,84,87,89,92,94,96,99,101,103,106,109,111,114,118,121,124,126,128,131,134,137,140,143,145,148,151,154,156,159,161,164,166,168,171,174, 'N/A', 'N/A', 'N/A'];
        const book7 = [22, 24, 26, 28, 29, 31, 33, 34, 36, 37, 38, 40, 41, 43, 44, 45, 47, 48, 50, 51, 52, 54, 55, 57, 59, 60, 62, 63, 64, 67, 68, 70, 71, 72, 74, 76, 77, 79, 80, 82, 83, 85, 87, 88, 90, 91, 93, 94, 96, 97, 99, 101, 102, 104, 106, 107, 109, 110, 111, 113, 114, 116, 118, 120, 'N/A', 'N/A', 'N/A'];
        const book8 = [8, 9, 10, 11, 13, 14, 16, 17, 19, 21, 22, 25, 26, 28, 30, 31, 33, 34, 36, 37, 39, 41, 42, 43, 45, 47, 49, 51, 53, 54, 56, 58, 60, 61, 62, 64, 66, 68, 70, 72, 73, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 97, 99, 101, 103, 105, 106, 107, 109, 110, 111, 112, 114, 'N/A', 'N/A', 'N/A'];
        const book9 = [16, 19, 21, 24, 27, 30, 33, 36, 39, 41, 44, 47, 50, 53, 55, 58, 61, 64, 66, 69, 72, 74, 77, 80, 83, 87, 89, 92, 95, 97, 100, 103, 105, 108, 111, 113, 116, 119, 122, 125, 127, 130, 133, 136, 138, 141, 144, 147, 149, 152, 155, 158, 161, 164, 166, 169, 172, 175, 178, 181, 183, 186, 189, 192, 'N/A', 'N/A', 'N/A'];
        // New Book Columns (10-12: Replace with your page numbers, 64 entries each)
        const book10 = Array(64).fill('N/A'); // Placeholder, e.g., [1,2,3,...] for your data
        const book11 = Array(64).fill('N/A'); // Placeholder
        const book12 = Array(64).fill('N/A'); // Placeholder

        // Consolidated books object
        const books = {
            'The Book of Changes': book1,
            'A Guide to the I Ching': book2,
            'The Complete I Ching.10th Ed': book3,
            'The Authentic I Ching': book4,
            'I Ching Pt.1': book5,
            'I Ching Pt.2': book6,
            'Taoist I Ching': book7,
            'Tao of Organisation': book8,
            'Astrology of I Ching': book9,
            'Book 10': book10,
            'Book 11': book11,
            'Book 12': book12
        };

        // ========== RENDERING AND FUNCTIONALITY ==========
        
        // Virtual rendering on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !document.getElementById('tableBody').innerHTML) {
                    renderTable();
                }
            });
        });
        observer.observe(document.getElementById('tableContainer'));

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            for (let i = 0; i < 64; i++) {
                const row = document.createElement('tr');
                let bookCells = '';
                Object.values(books).forEach(pages => {
                    bookCells += `<td>${pages[i] !== 'N/A' ? pages[i] : ''}</td>`;
                });
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${hexagrams[i]}</td>
                    <td>${names[i]}</td>
                    ${bookCells}
                `;
                tbody.appendChild(row);
            }
        }

        // Search functionality
        function filterTable() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }

        // Attach event listener for search
        document.getElementById('searchInput').addEventListener('keyup', filterTable);

        // Journal functionality
        let journal = JSON.parse(localStorage.getItem('ichingJournal')) || [];

        function addEntry(event) {
            event.preventDefault();
            const question = document.getElementById('question').value;
            const hex = document.getElementById('hex').value;
            const notes = document.getElementById('notes').value;
            if (!question || !hex) return alert('Please enter a question and hexagram!');

            const entry = { id: Date.now(), date: new Date().toISOString().split('T')[0], question, hex, notes };
            journal.unshift(entry);
            localStorage.setItem('ichingJournal', JSON.stringify(journal));
            displayJournal();
            document.getElementById('question').value = '';
            document.getElementById('hex').value = '';
            document.getElementById('notes').value = '';
        }

        function displayJournal() {
            const output = document.getElementById('journalOutput');
            output.innerHTML = journal.map(entry => `
                <div class="bg-white p-3 mb-2 rounded shadow">
                    <p><strong>Date:</strong> ${entry.date}</p>
                    <p><strong>Question:</strong> ${entry.question}</p>
                    <p><strong>Hex:</strong> ${entry.hex}</p>
                    <p><strong>Notes:</strong> ${entry.notes}</p>
                    <button onclick="deleteEntry(${entry.id})" class="text-red-500 hover:text-red-700">Delete</button>
                </div>
            `).join('');
        }

        function deleteEntry(id) {
            journal = journal.filter(e => e.id !== id);
            localStorage.setItem('ichingJournal', JSON.stringify(journal));
            displayJournal();
        }

        function exportJournal() {
            const csv = ['Date,Question,Hex,Notes'].concat(journal.map(e => `${e.date},"${e.question}",${e.hex},"${e.notes}"`)).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'iching-journal.csv';
            a.click();
        }

        // Load journal on page load
        displayJournal();
    </script>
</body>
</html>
