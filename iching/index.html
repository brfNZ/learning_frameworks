<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Ching Divination</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .book-cover {
            width: 80px;
            height: auto;
            object-fit: contain;
            margin: 0 auto 8px;
        }
        
        .i-ching-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .i-ching-table thead {
            background: #d1d5db;
        }
        
        .i-ching-table th {
            padding: 1rem;
            font-weight: bold;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .i-ching-table th:first-child { text-align: left; white-space: normal; width: 70px; }
        .i-ching-table th:nth-child(2) { text-align: center; white-space: nowrap; }
        .i-ching-table th:nth-child(3) { text-align: left; white-space: nowrap; }
        .i-ching-table th:nth-child(n+4) { text-align: center; width: 128px; font-size: 0.75rem; }
        
        .i-ching-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .i-ching-table td:first-child { padding: 0.75rem 0.5rem; white-space: nowrap; text-align: center; }
        .i-ching-table td:nth-child(2) { padding: 0.75rem 0.5rem; font-size: 2.5rem; white-space: nowrap; text-align: center; }
        .i-ching-table td:nth-child(3) { padding: 0.75rem 0.75rem; white-space: nowrap; }
        .i-ching-table td:nth-child(n+4) { text-align: center; }
        
        .i-ching-table tbody tr:nth-child(even) { background: #f3f4f6; }
        .i-ching-table tbody tr:hover { background: #f9fafb; }
        
        .selection-btn {
            padding: 20px 24px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            background: #fff;
            transition: all 0.2s;
            position: relative;
        }
        
        .selection-btn:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .selection-btn.selected {
            border-color: #3b82f6;
            background: #dbeafe;
            font-weight: 700;
            color: #1e40af;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .trigram-number, .stem-number {
            position: absolute;
            top: 8px;
            left: 12px;
            font-size: 1.25rem;
            font-weight: 700;
            color: #3b82f6;
        }
        
        .trigram-symbol {
            font-size: 4rem;
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .trigram-english {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .trigram-chinese {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .stem-time {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
            margin-top: 20px;
        }
        
        .stem-chinese {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        
        .result-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #86efac;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }
        
        .result-box h3 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #166534;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-box p {
            margin: 10px 0;
            color: #166534;
            font-size: 1.05rem;
        }
        
        .result-box strong {
            color: #14532d;
        }
        
        .calculation-box {
            background: #fff;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #166534;
            text-align: center;
        }
        
        .btn-primary {
            padding: 14px 28px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }
        
        .btn-toggle {
            padding: 10px 20px;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        
        .btn-toggle:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }
        
        .btn-success {
            padding: 12px 24px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            padding: 12px 24px;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .btn-info {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        
        .btn-info:hover {
            background: #2563eb;
        }
        
        .btn-danger {
            padding: 6px 14px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        textarea.input-field {
            min-height: 100px;
            resize: vertical;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subsection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-5xl font-bold text-gray-800 mb-4">‚òØ I Ching Divination</h1>
            <p class="text-xl text-gray-600 mb-6">Consult the Oracle and Record Your Insights</p>
            <a href="reference.html" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition shadow-md hover:shadow-lg">
                üìö View Reference Table
            </a>
        </div>

        <!-- Divination Section -->
        <div class="section-card">
            <h2 class="section-title">üéØ Divination</h2>
            
            <div class="mb-8">
                <div class="subsection-title">
                    <span>Select Lower Trigram (Bottom)</span>
                    <button class="btn-toggle" onclick="toggleSequence()">
                        <span id="sequenceLabel">Fu Xi Sequence</span> üîÑ
                    </button>
                </div>
                <div id="trigramGrid" class="grid grid-cols-2 gap-4">
                    <!-- Trigrams will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="mb-8">
                <h3 class="subsection-title">Select Heavenly Stem (Time of Day)</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3 mb-3">
                    <div class="selection-btn" data-value="1" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">1</div>
                        <div class="stem-time">11pm-1am</div>
                        <div class="stem-chinese">Geng</div>
                    </div>
                    <div class="selection-btn" data-value="2" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">2</div>
                        <div class="stem-time">1am-3am</div>
                        <div class="stem-chinese">Xin</div>
                    </div>
                    <div class="selection-btn" data-value="3" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">3</div>
                        <div class="stem-time">3am-5am</div>
                        <div class="stem-chinese">Ren</div>
                    </div>
                    <div class="selection-btn" data-value="4" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">4</div>
                        <div class="stem-time">5am-7am</div>
                        <div class="stem-chinese">Gui</div>
                    </div>
                    <div class="selection-btn" data-value="5" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">5</div>
                        <div class="stem-time">7am-9am</div>
                        <div class="stem-chinese">Jia</div>
                    </div>
                    <div class="selection-btn" data-value="6" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">6</div>
                        <div class="stem-time">9am-11am</div>
                        <div class="stem-chinese">Yi</div>
                    </div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3">
                    <div class="selection-btn" data-value="7" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">7</div>
                        <div class="stem-time">11am-1pm</div>
                        <div class="stem-chinese">Bing</div>
                    </div>
                    <div class="selection-btn" data-value="8" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">8</div>
                        <div class="stem-time">1pm-3pm</div>
                        <div class="stem-chinese">Ding</div>
                    </div>
                    <div class="selection-btn" data-value="9" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">9</div>
                        <div class="stem-time">3pm-5pm</div>
                        <div class="stem-chinese">Wu</div>
                    </div>
                    <div class="selection-btn" data-value="10" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">10</div>
                        <div class="stem-time">5pm-7pm</div>
                        <div class="stem-chinese">Ji</div>
                    </div>
                    <div class="selection-btn" data-value="11" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">11</div>
                        <div class="stem-time">7pm-9pm</div>
                        <div class="stem-chinese">Geng</div>
                    </div>
                    <div class="selection-btn" data-value="12" data-type="stem" onclick="selectStem(this)">
                        <div class="stem-number">12</div>
                        <div class="stem-time">9pm-11pm</div>
                        <div class="stem-chinese">Xin</div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button id="divineBtn" class="btn-primary" onclick="divineTrigramStem()" disabled>üîÆ Divine Hexagram</button>
            </div>
            
            <div id="divResult"></div>
        </div>

        <!-- Relevant Hexagrams Table -->
        <div id="relevantSection" style="display: none;">
            <div class="section-card">
                <h2 class="section-title">üîó Relevant Hexagrams</h2>
                <div class="overflow-x-auto">
                    <table class="i-ching-table">
                        <thead>
                            <tr>
                                <th>Gua<br>number</th>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th><img src="covers/iching.png" alt="The Book of Changes" class="book-cover">The Book of Changes</th>
                                <th><img src="covers/guide-iching.png" alt="A Guide to the I Ching" class="book-cover">A Guide to the I Ching</th>
                                <th><img src="covers/complete-iching.png" alt="The Complete I Ching.10th Ed" class="book-cover">The Complete I Ching.10th Ed</th>
                                <th><img src="covers/authentic-iching.png" alt="The Authentic I Ching" class="book-cover">The Authentic I Ching</th>
                                <th><img src="covers/iching-pt1.png" alt="I Ching Wilhelm Pt.1" class="book-cover">I Ching Pt.1</th>
                                <th><img src="covers/iching-pt2.png" alt="I Ching Wilhelm Pt.2" class="book-cover">I Ching Pt.2</th>
                                <th><img src="covers/taoist-iching.png" alt="Taoist I Ching" class="book-cover">Taoist I Ching</th>
                                <th><img src="covers/tao-organisation.png" alt="Tao of Organisation" class="book-cover">Tao of Organisation</th>
                                <th><img src="covers/astrology-iching.png" alt="Astrology of I Ching" class="book-cover">Astrology of I Ching</th>
                            </tr>
                        </thead>
                        <tbody id="relevantTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Journal Section -->
        <div class="section-card">
            <h2 class="section-title">üìî Journal</h2>
            
            <form onsubmit="addEntry(); return false;" class="mb-8">
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Question</label>
                        <input type="text" id="question" class="input-field" placeholder="What guidance do I need today?" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Hexagram</label>
                        <input type="text" id="hex" class="input-field" placeholder="e.g., 1: The Creative ‰∑Ä" required>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Results & Notes</label>
                    <textarea id="notes" class="input-field" placeholder="Record your interpretation, changing lines, and insights..."></textarea>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="btn-success">üíæ Save Entry</button>
                    <button type="button" onclick="exportJournal()" class="btn-secondary">üì• Export to CSV</button>
                </div>
            </form>
            
            <div class="overflow-x-auto">
                <table class="i-ching-table">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Date</th>
                            <th>Question</th>
                            <th style="width: 200px;">Hexagram</th>
                            <th>Notes</th>
                            <th style="width: 100px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="journalBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        // Import shared data
        import { hexagrams, names, book1, book2, book3, book4, book5, book6, book7, book8, book9 } from './data.js';

        let selectedTrigram = null;
        let selectedStem = null;
        let currentSequence = 'fuxi'; // 'fuxi' or 'kingwen'

        // Trigram data
        const trigrams = {
            1: { symbol: '‚ò∞', english: 'Heaven', chinese: 'Qian' },
            2: { symbol: '‚ò±', english: 'Lake', chinese: 'Dui' },
            3: { symbol: '‚ò≤', english: 'Fire', chinese: 'Li' },
            4: { symbol: '‚ò≥', english: 'Thunder', chinese: 'Zhen' },
            5: { symbol: '‚ò¥', english: 'Wind', chinese: 'Xun' },
            6: { symbol: '‚òµ', english: 'Water', chinese: 'Kan' },
            7: { symbol: '‚ò∂', english: 'Mountain', chinese: 'Gen' },
            8: { symbol: '‚ò∑', english: 'Earth', chinese: 'Kun' }
        };

        // Fu Xi sequence (Earlier Heaven)
        const fuxiSequence = [1, 5, 2, 6, 3, 7, 4, 8];

        // King Wen sequence (Later Heaven)
        const kingwenSequence = [6, 8, 4, 5, 1, 2, 7, 3];

        // Stem times for display
        const stemTimes = {
            1: '11pm-1am', 2: '1am-3am', 3: '3am-5am', 4: '5am-7am', 
            5: '7am-9am', 6: '9am-11am', 7: '11am-1pm', 8: '1pm-3pm',
            9: '3pm-5pm', 10: '5pm-7pm', 11: '7pm-9pm', 12: '9pm-11pm'
        };

        // Render trigrams based on current sequence
        function renderTrigrams() {
            const sequence = currentSequence === 'fuxi' ? fuxiSequence : kingwenSequence;
            const grid = document.getElementById('trigramGrid');
            grid.innerHTML = '';

            sequence.forEach((trigramValue, index) => {
                const displayNumber = index + 1; // Display 1-8
                const trigram = trigrams[trigramValue];
                const isSelected = selectedTrigram === trigramValue ? 'selected' : '';
                
                const btn = document.createElement('div');
                btn.className = `selection-btn ${isSelected}`;
                btn.setAttribute('data-value', trigramValue);
                btn.setAttribute('data-type', 'trigram');
                btn.onclick = function() { selectTrigram(this); };
                btn.innerHTML = `
                    <div class="trigram-number">${displayNumber}</div>
                    <div class="trigram-symbol">${trigram.symbol}</div>
                    <div class="trigram-english">${trigram.english}</div>
                    <div class="trigram-chinese">${trigram.chinese}</div>
                `;
                grid.appendChild(btn);
            });
        }

        // Toggle sequence
        window.toggleSequence = function() {
            currentSequence = currentSequence === 'fuxi' ? 'kingwen' : 'fuxi';
            document.getElementById('sequenceLabel').textContent = 
                currentSequence === 'fuxi' ? 'Fu Xi Sequence' : 'King Wen Sequence';
            renderTrigrams();
        }

        // Journal data and functions
        let journal = JSON.parse(localStorage.getItem('ichingJournal')) || [];

        window.addEntry = function() {
            const question = document.getElementById('question').value;
            const hex = document.getElementById('hex').value;
            const notes = document.getElementById('notes').value;
            if (!question || !hex) return alert('Please add question and hexagram!');
            
            const entry = { id: Date.now(), date: new Date().toISOString().split('T')[0], question, hex, notes };
            journal.unshift(entry);
            localStorage.setItem('ichingJournal', JSON.stringify(journal));
            displayJournal();
            clearForm();
        }

        function displayJournal() {
            const tbody = document.getElementById('journalBody');
            tbody.innerHTML = '';
            if (journal.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px; color:#6b7280;">No entries yet. Start by logging your first divination above.</td></tr>';
                return;
            }
            journal.forEach(entry => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.question}</td>
                    <td>${entry.hex}</td>
                    <td>${entry.notes || '-'}</td>
                    <td style="text-align:center;"><button onclick="deleteEntry(${entry.id})" class="btn-danger">Delete</button></td>
                `;
            });
        }

        window.deleteEntry = function(id) {
            if (!confirm('Delete this journal entry?')) return;
            journal = journal.filter(e => e.id !== id);
            localStorage.setItem('ichingJournal', JSON.stringify(journal));
            displayJournal();
        }

        function clearForm() {
            document.getElementById('question').value = '';
            document.getElementById('hex').value = '';
            document.getElementById('notes').value = '';
        }

        window.exportJournal = function() {
            if (journal.length === 0) {
                alert('No entries to export!');
                return;
            }
            const csv = ['Date,Question,Hexagram,Notes'].concat(journal.map(e => `${e.date},"${e.question}","${e.hex}","${e.notes || ''}"`)).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'iching-journal.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Divination functions with toggle behavior
        window.selectTrigram = function(btn) {
            const value = parseInt(btn.getAttribute('data-value'));
            
            if (btn.classList.contains('selected')) {
                btn.classList.remove('selected');
                selectedTrigram = null;
            } else {
                document.querySelectorAll('.selection-btn[data-type="trigram"]').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedTrigram = value;
            }
            
            checkSelection();
        }

        window.selectStem = function(btn) {
            const value = parseInt(btn.getAttribute('data-value'));
            
            if (btn.classList.contains('selected')) {
                btn.classList.remove('selected');
                selectedStem = null;
            } else {
                document.querySelectorAll('.selection-btn[data-type="stem"]').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedStem = value;
            }
            
            checkSelection();
        }

        function checkSelection() {
            const divineBtn = document.getElementById('divineBtn');
            if (selectedTrigram && selectedStem) {
                divineBtn.disabled = false;
            } else {
                divineBtn.disabled = true;
            }
        }

        window.divineTrigramStem = function() {
            if (!selectedTrigram || !selectedStem) return alert('Please select both a trigram and a stem!');

            const lowerTrigram = selectedTrigram;
            const sum = lowerTrigram + selectedStem;
            let upperTrigram = sum % 8;
            if (upperTrigram === 0) upperTrigram = 8;
            let movingLine = sum % 6 || 6;
            
            const kingWen = ((upperTrigram - 1) * 8) + lowerTrigram;
            const hexSymbol = hexagrams[kingWen - 1];
            const hexName = names[kingWen - 1];

            // Get names for display
            const lowerName = trigrams[lowerTrigram].chinese;
            const upperName = trigrams[upperTrigram].chinese;
            const stemTime = stemTimes[selectedStem];

            document.getElementById('divResult').innerHTML = `
                <div class="result-box">
                    <h3>‚ú® Divination Result</h3>
                    
                    <div class="calculation-box">
                        ${lowerName} ${lowerTrigram} + ${stemTime} ${selectedStem} ‚Üí ${lowerTrigram} + ${selectedStem} = ${sum}
                    </div>
                    <p><strong>Lower Trigram (Bottom):</strong> ${lowerName} (${lowerTrigram})</p>
                    <p><strong>Upper Trigram (Top):</strong> ${upperName} (${upperTrigram})</p>
                    <p><strong>Sum:</strong> ${sum} (${sum} mod 8 = ${upperTrigram})</p>
                    <p><strong>Hexagram:</strong> #${kingWen} ${hexSymbol} - ${hexName}</p>
                    <p><strong>Moving Line:</strong> ${movingLine} (${sum} mod 6 = ${movingLine})</p>
                    <div style="margin-top:20px; display:flex; gap:12px; flex-wrap:wrap;">
                        <button onclick="showRelevant(${kingWen})" class="btn-info">üìñ Show Related Hexagrams</button>
                        <button onclick="prefillJournal(${kingWen}, ${movingLine})" class="btn-success">üìù Add to Journal</button>
                    </div>
                </div>
            `;

            showRelevant(kingWen);
        }

        // Show relevant hexagrams
        window.showRelevant = function(kingWen) {
            const inverse = 65 - kingWen;
            const related = [kingWen];
            if (inverse > 0 && inverse <= 64 && inverse !== kingWen) related.push(inverse);

            const tbody = document.getElementById('relevantTableBody');
            tbody.innerHTML = '';
            related.forEach(n => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${n}</td>
                    <td>${hexagrams[n - 1]}</td>
                    <td>${names[n - 1]}</td>
                    <td>${book1[n - 1] || '-'}</td>
                    <td>${book2[n - 1] || '-'}</td>
                    <td>${book3[n - 1] || '-'}</td>
                    <td>${book4[n - 1] || '-'}</td>
                    <td>${book5[n - 1] || '-'}</td>
                    <td>${book6[n - 1] || '-'}</td>
                    <td>${book7[n - 1] || '-'}</td>
                    <td>${book8[n - 1] || '-'}</td>
                    <td>${book9[n - 1] || '-'}</td>
                `;
            });
            
            document.getElementById('relevantSection').style.display = 'block';
        }

        // Prefill journal
        window.prefillJournal = function(kingWen, movingLine) {
            const hex = `${kingWen}: ${names[kingWen - 1]} ${hexagrams[kingWen - 1]} (Line ${movingLine})`;
            document.getElementById('hex').value = hex;
            document.getElementById('question').focus();
            window.scrollTo({ top: document.getElementById('question').offsetTop - 100, behavior: 'smooth' });
        }

        // Initialize
        renderTrigrams();
        displayJournal();
    </script>
</body>
</html>
