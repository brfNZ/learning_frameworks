<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Hero Decision Matrix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hero-icon {
            width: 32px;
            height: 32px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .small-icon {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            decision: '',
            options: ['', ''],
            currentStep: 0,
            responses: {},
            showResults: false,
            selectedQuestions: []
        };

        // Heroes configuration with all questions
        const heroesQuestions = {
            spiritual: {
                name: "Spiritual Wisdom",
                color: "bg-purple-100 border-purple-300 text-purple-800",
                core: "What does my inner wisdom say about each [DECISION] option?",
                questions: [
                    "Which option comes from love rather than fear?",
                    "How does this serve the greater good beyond just myself?",
                    "What would I choose if I were completely unattached to the outcome?"
                ],
                focus: "Divine guidance and intuition"
            },
            socrates: {
                name: "Socrates",
                color: "bg-blue-100 border-blue-300 text-blue-800",
                core: "What assumptions am I making about [DECISION] that I haven't examined?",
                questions: [
                    "What would happen if I'm completely wrong about this?",
                    "What do I truly know vs. what do I think I know about [DECISION]?",
                    "What questions should I be asking about [DECISION] that I'm not?"
                ],
                focus: "Questioning assumptions and seeking truth"
            },
            aristotle: {
                name: "Aristotle",
                color: "bg-orange-100 border-orange-300 text-orange-800",
                core: "What are the logical consequences of each [DECISION] option?",
                questions: [
                    "Which choice leads to the most flourishing (eudaimonia)?",
                    "What would the virtuous person do in this situation?",
                    "Which option represents the golden mean between extremes?"
                ],
                focus: "Logical analysis and virtue"
            },
            aynRand: {
                name: "Ayn Rand",
                color: "bg-green-100 border-green-300 text-green-800",
                core: "Which [DECISION] option best serves my rational self-interest?",
                questions: [
                    "Am I making this choice based on my own judgment or others' expectations?",
                    "Which option creates the most genuine value?",
                    "Does this align with my core principles and values?"
                ],
                focus: "Independent rational judgment"
            }
        };

        // Helper functions
        function addOption() {
            if (state.options.length < 5) {
                state.options.push('');
                render();
            }
        }

        function removeOption(index) {
            if (state.options.length > 2) {
                state.options.splice(index, 1);
                render();
            }
        }

        function updateOption(index, value) {
            state.options[index] = value;
        }

        function generateQuestions() {
            console.log('generateQuestions called');
            const questions = [];
            const heroOrder = ['spiritual', 'socrates', 'aristotle', 'aynRand'];
            
            // Add 4 core questions in fixed order
            heroOrder.forEach(heroKey => {
                const hero = heroesQuestions[heroKey];
                questions.push({
                    hero: hero.name,
                    question: hero.core.replace(/\[DECISION\]/g, state.decision),
                    color: hero.color,
                    focus: hero.focus,
                    isCore: true
                });
            });

            // Add 4 random specific questions, one from each hero in order
            heroOrder.forEach(heroKey => {
                const hero = heroesQuestions[heroKey];
                const randomIndex = Math.floor(Math.random() * hero.questions.length);
                questions.push({
                    hero: hero.name,
                    question: hero.questions[randomIndex].replace(/\[DECISION\]/g, state.decision),
                    color: hero.color,
                    focus: hero.focus,
                    isCore: false
                });
            });

            // Add 1 additional random question from any hero
            const allHeroes = Object.values(heroesQuestions);
            const randomHero = allHeroes[Math.floor(Math.random() * allHeroes.length)];
            const availableQuestions = randomHero.questions.filter(q => 
                !questions.some(existing => existing.question === q.replace(/\[DECISION\]/g, state.decision))
            );
            
            if (availableQuestions.length > 0) {
                const randomQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
                questions.push({
                    hero: randomHero.name,
                    question: randomQuestion.replace(/\[DECISION\]/g, state.decision),
                    color: randomHero.color,
                    focus: randomHero.focus,
                    isCore: false
                });
            }

            console.log('Generated questions:', questions.length);
            return questions;
        }

        function handleResponse(questionIndex, optionIndex, rating) {
            const key = `${questionIndex}-${optionIndex}`;
            state.responses[key] = rating;
            console.log('Response recorded:', key, rating);
        }

        function calculateScores() {
            const scores = state.options.map(() => ({ total: 0, breakdown: {} }));
            
            state.selectedQuestions.forEach((question, questionIndex) => {
                state.options.forEach((option, optionIndex) => {
                    const key = `${questionIndex}-${optionIndex}`;
                    const response = state.responses[key] || 0;
                    scores[optionIndex].total += response;
                    
                    if (!scores[optionIndex].breakdown[question.hero]) {
                        scores[optionIndex].breakdown[question.hero] = 0;
                    }
                    scores[optionIndex].breakdown[question.hero] += response;
                });
            });

            return scores;
        }

        function resetMatrix() {
            state = {
                decision: '',
                options: ['', ''],
                currentStep: 0,
                responses: {},
                showResults: false,
                selectedQuestions: []
            };
            render();
        }

        // Render functions
        function renderSetup() {
            return `
                <div class="max-w-2xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Simplified Hero Decision Matrix</h1>
                        <p class="text-gray-600">9 focused questions to examine your decision thoroughly</p>
                    </div>

                    <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">What decision are you facing?</h2>
                        <textarea
                            id="decisionInput"
                            placeholder="Describe the decision you need to make..."
                            class="w-full p-3 border border-gray-300 rounded-lg resize-none h-24"
                        >${state.decision}</textarea>

                        <h3 class="text-lg font-bold text-gray-800 mt-6 mb-4">What are your options?</h3>
                        <div class="space-y-3" id="optionsContainer">
                            ${state.options.map((option, index) => `
                                <div class="flex items-center space-x-3">
                                    <span class="text-sm font-semibold text-gray-600">Option ${index + 1}:</span>
                                    <input
                                        type="text"
                                        value="${option}"
                                        placeholder="Enter option ${index + 1}..."
                                        class="flex-1 p-2 border border-gray-300 rounded-lg option-input"
                                        data-index="${index}"
                                    />
                                    ${state.options.length > 2 ? `
                                        <button onclick="removeOption(${index})" class="text-red-600 hover:text-red-800">
                                            <svg class="small-icon" viewBox="0 0 24 24">
                                                <line x1="18" y1="6" x2="6" y2="18"/>
                                                <line x1="6" y1="6" x2="18" y2="18"/>
                                            </svg>
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>

                        ${state.options.length < 5 ? `
                            <button onclick="addOption()" class="mt-3 flex items-center text-blue-600 hover:text-blue-800">
                                <svg class="small-icon mr-1" viewBox="0 0 24 24">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Add another option
                            </button>
                        ` : ''}

                        <button
                            id="beginAnalysis"
                            class="w-full mt-6 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white py-3 rounded-lg font-semibold"
                        >
                            Begin Analysis (9 Questions)
                        </button>
                    </div>
                </div>
            `;
        }

        function renderQuestions() {
            const currentQuestion = state.selectedQuestions[state.currentStep - 1];
            const totalSteps = 9;
            const numOptions = state.options.length;
            const offset = (state.currentStep - 1) % numOptions;

            let optionsHtml = '';
            for (let i = 0; i < numOptions; i++) {
                const displayIndex = (i + offset) % numOptions;
                const originalIndex = displayIndex;
                const option = state.options[originalIndex];
                optionsHtml += `
                    <div class="bg-white p-4 rounded-lg border-2 border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-3">Option ${originalIndex + 1}: ${option}</h4>
                        <div class="flex items-center justify-center space-x-6">
                            ${[1, 2, 3].map(rating => {
                                const responseKey = `${state.currentStep - 1}-${originalIndex}`;
                                const isSelected = state.responses[responseKey] === rating;
                                const ratingLabel = rating === 1 ? 'Not examined' : rating === 2 ? 'Some thought' : 'Deep thought';
                                return `
                                    <div class="text-center">
                                        <button
                                            class="rating-btn w-16 h-16 rounded-full border-2 transition-all text-lg font-bold mb-2 ${isSelected ? 'bg-blue-600 border-blue-600 text-white' : 'border-gray-300 hover:border-blue-400'}"
                                            onclick="handleRatingClick(${state.currentStep - 1}, ${originalIndex}, ${rating})"
                                        >
                                            ${rating}
                                        </button>
                                        <div class="text-xs text-gray-600 w-20">${ratingLabel}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            return `
                <div class="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Simplified Hero Decision Matrix</h1>
                        <p class="text-gray-600 mb-4">Decision: <span class="font-semibold">${state.decision}</span></p>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div
                                class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                style="width: ${(state.currentStep / totalSteps) * 100}%"
                            ></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Question ${state.currentStep} of ${totalSteps}</p>
                    </div>

                    <div class="${currentQuestion.color} p-6 rounded-lg border-2 mb-6">
                        <div class="flex items-center mb-4">
                            <div class="mr-4">
                                <svg class="hero-icon" viewBox="0 0 24 24">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold">${currentQuestion.hero}</h2>
                                <p class="text-sm opacity-80">${currentQuestion.focus}</p>
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold mb-4">${currentQuestion.question}</h3>
                    </div>

                    <div class="space-y-4">
                        ${optionsHtml}
                    </div>

                    <div class="flex justify-between mt-8">
                        <button
                            id="prevBtn"
                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg"
                            onclick="goToPrevious()"
                        >
                            Previous
                        </button>
                        <button
                            id="nextBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg"
                            onclick="goToNext()"
                        >
                            ${state.currentStep < totalSteps ? 'Next' : 'See Results'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderResults() {
            const scores = calculateScores();
            const maxScore = Math.max(...scores.map(s => s.total));

            return `
                <div class="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Decision Analysis Results</h1>
                        <p class="text-gray-600 mb-4">Decision: <span class="font-semibold">${state.decision}</span></p>
                        <button
                            onclick="resetMatrix()"
                            class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm"
                        >
                            New Decision
                        </button>
                    </div>

                    <div class="space-y-6">
                        ${state.options.map((option, index) => {
                            const score = scores[index];
                            const isTop = score.total === maxScore;
                            
                            return `
                                <div class="${isTop ? 'bg-yellow-50 border-yellow-300' : 'bg-white border-gray-200'} p-6 rounded-lg border-2">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-xl font-bold text-gray-800">Option ${index + 1}: ${option}</h3>
                                        <div class="flex items-center">
                                            ${isTop ? '<svg class="w-6 h-6 text-yellow-600 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22,4 12,14.01 9,11.01"></polyline></svg>' : ''}
                                            <span class="text-2xl font-bold text-gray-800">${score.total}/27</span>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        ${Object.keys(score.breakdown).map(hero => `
                                            <div class="text-center p-3 bg-gray-100 rounded-lg">
                                                <p class="text-sm font-semibold text-gray-700">${hero}</p>
                                                <p class="text-lg font-bold text-gray-800">${score.breakdown[hero] || 0}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div class="mt-8 p-6 bg-white rounded-lg border-2 border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">Questions You Analyzed</h3>
                        <div class="space-y-2 text-sm text-gray-600">
                            ${state.selectedQuestions.map((q, i) => `
                                <p><strong>Q${i+1} (${q.hero}):</strong> ${q.question}</p>
                            `).join('')}
                        </div>
                        
                        <h4 class="text-lg font-bold text-gray-800 mt-6 mb-3">Interpretation</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><strong>Highest scoring option:</strong> This is where you've done the most thorough analysis across all wisdom traditions.</p>
                            <p><strong>Score gaps:</strong> Large differences suggest you've examined some options more deeply than others.</p>
                            <p><strong>Low scores overall:</strong> Consider doing more research/reflection before deciding.</p>
                            <p><strong>Remember:</strong> The numbers guide you, but your final choice should integrate both analysis and intuition.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event handlers as global functions
        function handleRatingClick(questionIndex, optionIndex, rating) {
            handleResponse(questionIndex, optionIndex, rating);
            render();
        }

        function goToPrevious() {
            state.currentStep = Math.max(1, state.currentStep - 1);
            render();
        }

        function goToNext() {
            const totalSteps = 9;
            if (state.currentStep < totalSteps) {
                state.currentStep += 1;
                render();
            } else {
                state.showResults = true;
                render();
            }
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.showResults) {
                app.innerHTML = renderResults();
            } else if (state.currentStep === 0) {
                app.innerHTML = renderSetup();
                setupEventListeners();
            } else {
                app.innerHTML = renderQuestions();
            }
        }

        function setupEventListeners() {
            // Decision input
            const decisionInput = document.getElementById('decisionInput');
            if (decisionInput) {
                decisionInput.addEventListener('input', (e) => {
                    state.decision = e.target.value;
                });
            }

            // Option inputs
            document.querySelectorAll('.option-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    updateOption(index, e.target.value);
                });
            });

            // Begin analysis button
            const beginBtn = document.getElementById('beginAnalysis');
            if (beginBtn) {
                beginBtn.addEventListener('click', () => {
                    console.log('Begin button clicked');
                    console.log('Decision:', state.decision);
                    console.log('Options:', state.options);
                    
                    if (state.decision.trim() && state.options.every(opt => opt.trim())) {
                        console.log('Generating questions...');
                        state.selectedQuestions = generateQuestions();
                        state.currentStep = 1;
                        render();
                    } else {
                        console.log('Validation failed');
                    }
                });
            }

            // Update button state
            const updateButtonState = () => {
                if (beginBtn) {
                    beginBtn.disabled = !state.decision.trim() || !state.options.every(opt => opt.trim());
                }
            };
            updateButtonState();
            if (decisionInput) {
                decisionInput.addEventListener('input', updateButtonState);
            }
            document.querySelectorAll('.option-input').forEach(input => {
                input.addEventListener('input', updateButtonState);
            });
        }

        // Make functions globally available
        window.addOption = addOption;
        window.removeOption = removeOption;
        window.resetMatrix = resetMatrix;
        window.handleRatingClick = handleRatingClick;
        window.goToPrevious = goToPrevious;
        window.goToNext = goToNext;

        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });
    </script>
</body>
</html>
