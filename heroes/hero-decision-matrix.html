<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Hero Decision Matrix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .hero-icon {
            width: 32px;
            height: 32px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .small-icon {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .rating-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            align-items: flex-start;
        }
        .rating-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 80px;
        }
        .rating-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rating-label {
            text-align: center;
            min-width: 80px;
            font-size: 12px;
            margin-top: 4px;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            decision: '',
            options: ['', ''],
            responses: {},
            showResults: false,
            selectedQuestions: []
        };

        // Heroes configuration with all questions
        const heroesQuestions = {
            spiritual: {
                name: "Spiritual Wisdom",
                color: "bg-purple-100 border-purple-300 text-purple-800",
                core: "What does my inner wisdom say about each option?",
                questions: [
                    "Which option comes from love rather than fear?",
                    "Which option brings the greatest peace and light?",
                    "What would I choose if I were completely unattached to the outcome?"
                ],
                focus: "Divine guidance and intuition"
            },
            socrates: {
                name: "Socrates",
                color: "bg-blue-100 border-blue-300 text-blue-800",
                core: "What assumptions am I making that I haven't examined?",
                questions: [
                    "What would happen if I'm completely wrong about this?",
                    "What do I truly know vs. what do I think I know?",
                    "What questions should I be asking that I'm not?"
                ],
                focus: "Questioning assumptions and seeking truth"
            },
            aristotle: {
                name: "Aristotle",
                color: "bg-orange-100 border-orange-300 text-orange-800",
                core: "What are the logical consequences of each option?",
                questions: [
                    "Which choice leads to the most flourishing (eudaimonia)?",
                    "What would the virtuous person do in this situation?",
                    "Which option represents the golden mean between extremes?"
                ],
                focus: "Logical analysis and virtue"
            },
            aynRand: {
                name: "Ayn Rand",
                color: "bg-green-100 border-green-300 text-green-800",
                core: "Which option best serves my rational self-interest?",
                questions: [
                    "Am I making this choice based on my own judgment or others' expectations?",
                    "Which option creates the most genuine value?",
                    "Does this align with my core principles and values?"
                ],
                focus: "Independent rational judgment"
            }
        };

        // Helper functions
        function addOption() {
            if (state.options.length < 5) {
                state.options.push('');
                render();
            }
        }

        function removeOption(index) {
            if (state.options.length > 2) {
                state.options.splice(index, 1);
                render();
            }
        }

        function updateOption(index, value) {
            state.options[index] = value;
        }

        function generateQuestions() {
            const questions = [];
            const heroOrder = ['spiritual', 'socrates', 'aristotle', 'aynRand'];

            // Add 4 core questions in fixed order
            heroOrder.forEach(heroKey => {
                const hero = heroesQuestions[heroKey];
                questions.push({
                    hero: hero.name,
                    question: hero.core,
                    color: hero.color,
                    focus: hero.focus,
                    isCore: true
                });
            });

            // Add 4 random specific questions, one from each hero in order
            heroOrder.forEach(heroKey => {
                const hero = heroesQuestions[heroKey];
                const randomIndex = Math.floor(Math.random() * hero.questions.length);
                questions.push({
                    hero: hero.name,
                    question: hero.questions[randomIndex],
                    color: hero.color,
                    focus: hero.focus,
                    isCore: false
                });
            });

            // Add 1 additional random question from any hero
            const allHeroes = Object.values(heroesQuestions);
            const randomHero = allHeroes[Math.floor(Math.random() * allHeroes.length)];
            const availableQuestions = randomHero.questions.filter(q => 
                !questions.some(existing => existing.question === q)
            );

            if (availableQuestions.length > 0) {
                const randomQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
                questions.push({
                    hero: randomHero.name,
                    question: randomQuestion,
                    color: randomHero.color,
                    focus: randomHero.focus,
                    isCore: false
                });
            }

            return questions;
        }

        function handleResponse(questionIndex, optionIndex, rating) {
            const key = `${questionIndex}-${optionIndex}`;
            state.responses[key] = rating;
        }

        function calculateScores() {
            const scores = state.options.map(() => ({ total: 0, breakdown: {} }));

            state.selectedQuestions.forEach((question, questionIndex) => {
                state.options.forEach((option, optionIndex) => {
                    const key = `${questionIndex}-${optionIndex}`;
                    const response = state.responses[key] || 0;
                    scores[optionIndex].total += response;

                    if (!scores[optionIndex].breakdown[question.hero]) {
                        scores[optionIndex].breakdown[question.hero] = 0;
                    }
                    scores[optionIndex].breakdown[question.hero] += response;
                });
            });

            return scores;
        }

        function resetMatrix() {
            state = {
                decision: '',
                options: ['', ''],
                responses: {},
                showResults: false,
                selectedQuestions: []
            };
            render();
        }

        function getRatingLabel(rating) {
            const labels = {
                1: 'Not suitable',
                2: '', // Intentionally blank for alignment
                3: '', // Intentionally blank for alignment
                4: '', // Intentionally blank for alignment
                5: 'Highly suitable'
            };
            return labels[rating] || '';
        }

        // Export functions
        function exportToCSV() {
            const scores = calculateScores();
            const maxScore = Math.max(...scores.map(s => s.total));
            let csv = 'Question #,Hero,Question Text';
            state.options.forEach((opt, i) => {
                csv += `,Option ${i+1} Rating (${opt}),Option ${i+1} Total (${scores[i].total}/${state.selectedQuestions.length * 5})`;
            });
$csv += '\n';$
            state.selectedQuestions.forEach((q, i) => {
                csv += `${i+1},"${q.hero}","${q.question.replace(/"/g, '""')}"`;
                state.options.forEach((opt, optIndex) => {
                    const rating = state.responses[`${i}-${optIndex}`] || '';
                    csv += `,${rating}`;
                });
$csv += '\n';$
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `hero-decision-matrix-${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function exportToPDF() {
            const scores = calculateScores();
            const maxScore = Math.max(...scores.map(s => s.total));
            const exportDiv = document.createElement('div');
            exportDiv.style.cssText = 'font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;';
            exportDiv.innerHTML = `
                <h1 style="text-align: center; margin-bottom: 20px;">Hero Decision Matrix Results</h1>
                <p><strong>Decision:</strong> ${state.decision}</p>
                <p><strong>Exported:</strong> ${new Date().toLocaleDateString()}</p>
                <h2 style="margin-top: 30px;">Summary</h2>
                <table style="width: 100%; border-collapse: collapse;">
                    ${state.options.map((opt, i) => `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">${opt}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">${scores[i].total}/45</td>
                        </tr>
                    `).join('')}
                </table>
            `;
            document.body.appendChild(exportDiv);

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const canvas = await html2canvas(exportDiv);
            const imgData = canvas.toDataURL('image/png');
            pdf.addImage(imgData, 'PNG', 10, 10, 190, 0);
            pdf.save(`hero-decision-matrix-${Date.now()}.pdf`);

            document.body.removeChild(exportDiv);
        }

        async function exportSlideshowPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let isFirst = true;

            async function addPage(content) {
                const div = document.createElement('div');
                div.style.cssText = 'font-family: Arial, sans-serif; padding: 20px; width: 595px; min-height: 842px; background: white; box-sizing: border-box;';
                div.innerHTML = content;
                document.body.appendChild(div);

                const canvas = await html2canvas(div, {
                    backgroundColor: '#ffffff',
                    scale: 1,
                    width: 595,
                    height: 842,
                    useCORS: true
                });
                const imgData = canvas.toDataURL('image/png');

                if (!isFirst) pdf.addPage();
                isFirst = false;

                const imgWidth = 210;
                const imgHeight = 297;
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

                document.body.removeChild(div);
            }

            // Title slide
            await addPage(`
                <div style="text-align: center; padding-top: 100px;">
                    <h1 style="font-size: 36px; margin-bottom: 30px;">Hero Decision Matrix</h1>
                    <h2 style="font-size: 24px; margin-bottom: 20px;">Decision Analysis</h2>
                    <p style="font-size: 18px;">${state.decision}</p>
                    <p style="font-size: 14px; margin-top: 40px;">${new Date().toLocaleDateString()}</p>
                </div>
            `);

            // Options page
            await addPage(`
                <h1 style="text-align: center; margin-bottom: 40px;">Your Options</h1>
                ${state.options.map((opt, i) => `
                    <p style="margin: 20px 0; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                        <strong>Option ${i + 1}:</strong> ${opt}
                    </p>
                `).join('')}
            `);

            // Question slides
            for (let i = 0; i < state.selectedQuestions.length; i++) {
                const q = state.selectedQuestions[i];
                await addPage(`
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2>${q.hero}</h2>
                        <p style="font-size: 14px;">${q.focus}</p>
                    </div>
                    <h3 style="text-align: center; margin-bottom: 25px;">${q.question}</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="background: #f9fafb;">
                            <th style="border: 1px solid #ddd; padding: 8px;">Option</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Rating</th>
                        </tr>
                        ${state.options.map((opt, oi) => `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;">${opt}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${state.responses[`${i}-${oi}`] || ''}</td>
                            </tr>
                        `).join('')}
                    </table>
                `);
            }

            // Comprehensive Summary slide (replacing previous results and text summary slides)
            const scores = calculateScores();
            const maxScore = Math.max(...scores.map(s => s.total));
            await addPage(`
                <h1 style="text-align: center; margin-bottom: 30px;">Comprehensive Decision Analysis</h1>
                <h2 style="margin-top: 20px; margin-bottom: 10px;">Final Results</h2>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tr style="background: #f9fafb;">
                        <th style="border: 1px solid #ddd; padding: 8px;">Option</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Score</th>
                    </tr>
                    ${state.options.map((opt, i) => `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">${opt}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${scores[i].total}/45 ${scores[i].total === maxScore ? '🏆' : ''}</td>
                        </tr>
                    `).join('')}
                </table>
                <h2 style="margin-top: 20px; margin-bottom: 10px;">Questions You Analyzed</h2>
                <ul style="list-style-type: disc; padding-left: 20px; font-size: 12px; line-height: 1.5; margin-bottom: 20px;">
                    ${state.selectedQuestions.map((q, i) => `
                        <li><strong>Q${i + 1}:</strong> ${q.hero} - ${q.question}</li>
                    `).join('')}
                </ul>
            `);
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="container mx-auto p-4">
                    <h1 class="text-2xl font-bold mb-4">Hero Decision Matrix</h1>
                    <div class="mb-4">
                        <label for="decision" class="block text-sm font-medium text-gray-700">Decision:</label>
                        <input type="text" id="decision" class="mt-1 p-2 w-full border rounded-md" value="${state.decision}" oninput="updateDecision(this.value)">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Options:</label>
                        ${state.options.map((opt, i) => `
                            <div class="flex items-center mb-2">
                                <input type="text" class="flex-1 p-2 border rounded-md" value="${opt}" oninput="updateOption(${i}, this.value)">
                                <button class="ml-2 p-2 bg-red-500 text-white rounded-md" onclick="removeOption(${i})">Remove</button>
                            </div>
                        `).join('')}
                        <button class="mt-2 p-2 bg-blue-500 text-white rounded-md" onclick="addOption()">Add Option</button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Questions:</label>
                        <div class="grid grid-cols-2 gap-4">
                            ${state.selectedQuestions.map((q, i) => `
                                <div class="p-4 border rounded-md ${q.color}">
                                    <h3 class="text-lg font-semibold">${q.hero}</h3>
                                    <p class="text-sm">${q.question}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Rate Options:</label>
                        <div class="grid grid-cols-2 gap-4">
                            ${state.selectedQuestions.map((q, qi) => `
                                <div>
                                    <h4 class="text-lg font-semibold">${q.hero} - ${q.question}</h4>
                                    <div class="grid grid-cols-${state.options.length} gap-4">
                                        ${state.options.map((opt, oi) => `
                                            <div class="text-center">
                                                <p class="text-sm">${opt}</p>
                                                <div class="rating-container">
                                                    <button class="rating-btn bg-gray-200 hover:bg-gray-300" onclick="handleResponse(${qi}, ${oi}, 1)">1</button>
                                                    <button class="rating-btn bg-gray-200 hover:bg-gray-300" onclick="handleResponse(${qi}, ${oi}, 2)">2</button>
                                                    <button class="rating-btn bg-gray-200 hover:bg-gray-300" onclick="handleResponse(${qi}, ${oi}, 3)">3</button>
                                                    <button class="rating-btn bg-gray-200 hover:bg-gray-300" onclick="handleResponse(${qi}, ${oi}, 4)">4</button>
                                                    <button class="rating-btn bg-gray-200 hover:bg-gray-300" onclick="handleResponse(${qi}, ${oi}, 5)">5</button>
                                                </div>
                                                <p class="rating-label">${getRatingLabel(state.responses[`${qi}-${oi}`])}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button class="p-2 bg-green-500 text-white rounded-md" onclick="resetMatrix()">Reset Matrix</button>
                        <div>
                            <button class="p-2 bg-blue-500 text-white rounded-md mr-2" onclick="exportToCSV()">Export to CSV</button>
                            <button class="p-2 bg-blue-500 text-white rounded-md mr-2" onclick="exportToPDF()">Export to PDF</button>
                            <button class="p-2 bg-blue-500 text-white rounded-md" onclick="exportSlideshowPDF()">Export Slideshow PDF</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateDecision(value) {
            state.decision = value;
        }

        // Initial render
        state.selectedQuestions = generateQuestions();
        render();
    </script>
</body>
</html>
