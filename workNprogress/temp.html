<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>My Trading Journal</title>
 <style>
  :root {
    --primary: #8cc2ee;
    --primary-dark: #64a5df;
    --primary-text: #2c5f8d;
    --primary-light-bg: #f5f9ff;
    --success: #A8D5A8;
    --success-dark: #95C895;
    --success-text: #4a7a4a;
    --success-light-bg: #fefffe;
    --danger: #E8A5A5;
    --danger-dark: #D99494;
    --danger-text: #8d4a4a;
    --danger-light-bg: #fffefe;
    --info: #B8D0E8;
    --light: #F8F9FB;
    --dark: #5A6B7A;
    --gradient: linear-gradient(135deg, #FAFBFC 0%, #F0F2F5 100%);
    --table-header-gradient: #5A9BD4;
    --radius: 12px;
    --radius-sm: 8px;
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    --transition: all 0.3s ease;
  }

  body {
    background: var(--gradient);
    color: var(--dark);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    padding: 15px;
    margin: 0 auto;
    min-height: 100vh;
    max-width: 900px;
  }

  h1 { text-align: center; margin-bottom: 20px; color: var(--dark); font-size: 24px; font-weight: 600; }

  .nav-buttons, .date-filter-container {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .nav-button, .filter-btn {
    background-color: white;
    color: var(--primary);
    padding: 8px 16px;
    border: 2px solid var(--primary);
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: var(--transition);
  }
  .nav-button.active, .filter-btn.active {
    background-color: var(--primary);
    color: white;
  }
  .nav-button:hover, .filter-btn:hover {
    background-color: var(--primary-dark);
    color: white;
    border-color: var(--primary-dark);
  }
  .filter-btn.active { box-shadow: 0 2px 8px rgba(140, 194, 238, 0.3); }

  .section { display: none; }
  .section.active { display: block; }

  .question { margin: 8px 0; }
  .question + .question { margin-top: 4px; }

  select { padding: 6px 8px; height: 36px; font-size: 13px; line-height: 1.4; }
  select:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(123, 179, 224, 0.1); }

  .section-header {
    background: var(--primary-light-bg);
    color: var(--primary-text);
    padding: 10px 15px;
    border: 2px solid var(--primary);
    border-radius: var(--radius);
    margin: 2px 0 4px 0;
    text-align: center;
    font-weight: 600;
    font-size: 14px;
  }
  .section-header.positive {
    background: #f6fff6;
    color: var(--success-text);
    border: 2px solid var(--success);
  }
  .section-header.danger {
    background: #fcf5f6;
    color: var(--danger-text);
    border: 2px solid var(--danger);
  }
  .section-header.collapsible {
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .section-header.collapsible:hover {
    background: #d1ebfd;
    border-color: var(--primary-dark);
  }
  .section-header.collapsible .arrow {
    transition: transform 0.3s ease;
    font-size: 16px;
  }
  .section-header.collapsible.expanded .arrow { transform: rotate(180deg); }

  .collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
  }
  .collapsible-content.expanded { max-height: 3000px; }

  .rating-container {
    display: flex;
    justify-content: center;
    gap: 3px;
    align-items: center;
    margin: 6px 0;
  }
  .emoji-btn {
    width: 32px;
    height: 32px;
    padding: 2px;
    border-radius: var(--radius);
    transition: var(--transition);
    font-size: 22px;
    line-height: 1;
    font-weight: 500;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--primary);
    background-color: var(--primary-light-bg);
    color: var(--primary-text);
    cursor: pointer;
  }
  .emoji-btn:hover { border-color: var(--primary-dark); background-color: #d1ebfd; }
  .emoji-btn.selected {
    background-color: var(--primary);
    border-color: var(--primary-dark);
    color: white;
    border-width: 3px;
    box-shadow: 0 0 0 2px rgba(123, 179, 224, 0.2);
  }
  /* Scale down X and O to match checkmark size */
  .rating-container .emoji-btn:nth-child(1),
  .rating-container .emoji-btn:nth-child(2) {
    font-size: 18px;
  }

  .rating-question, .green-flag-container, .red-flag-container {
    background: white;
    border-radius: var(--radius);
    padding: 10px;
    margin: 6px 0;
    border: 1px solid #E5E7EB;
    box-shadow: var(--shadow);
  }
  .rating-question label { text-align: center; font-weight: 500; margin-bottom: 6px; font-size: 13px; }

  label {
    display: block;
    margin-bottom: 4px;
    font-weight: 500;
    color: var(--dark);
    font-size: 13px;
  }
  input[type="text"], input[type="date"], input[type="number"], textarea, select {
    width: 100%;
    padding: 8px 10px;
    background-color: white;
    color: var(--dark);
    border: 2px solid #E5E7EB;
    border-radius: var(--radius-sm);
    font-size: 14px;
    box-sizing: border-box;
    transition: var(--transition);
  }
  input:focus, textarea:focus, select:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(123, 179, 224, 0.1);
  }
  textarea { height: 60px; resize: vertical; }

  .green-flag-grid, .red-flag-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 8px;
    margin-top: 10px;
  }
  .green-flag-btn, .red-flag-btn {
    padding: 8px 12px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 6px;
    justify-content: center;
  }
  .green-flag-btn {
    border: 2px solid var(--success);
    color: var(--success-text);
    background-color: var(--success-light-bg);
  }
  .green-flag-btn:hover, .green-flag-btn.active {
    background-color: var(--success);
    color: white;
    box-shadow: 0 2px 8px rgba(168, 213, 168, 0.3);
  }
  .red-flag-btn {
    border: 2px solid var(--danger);
    color: var(--danger-text);
    background-color: var(--danger-light-bg);
  }
  .red-flag-btn:hover, .red-flag-btn.active {
    background-color: var(--danger);
    color: white;
    box-shadow: 0 2px 8px rgba(232, 165, 165, 0.3);
  }

  /* â†â†â† CRITICAL: Weekly table mobile scroll â†’â†’â†’ */
  #weeklyTable {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin-top: 15px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  table {
    width: 100%;
    min-width: 850px;           /* forces horizontal scroll on small screens */
    border-collapse: collapse;
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    font-size: 13px;
  }
  th, td {
    border: 1px solid #E5E7EB;
    padding: 8px 10px;
    text-align: left;
    box-sizing: border-box;
  }
  th {
    background: linear-gradient(180deg, var(--table-header-gradient) 0%, var(--primary) 100%);
    color: white;
    font-weight: 500;
    font-size: 12px;
  }
  td { background-color: white; color: var(--dark); }
  tr:nth-child(even) td { background-color: #FAFBFC; }

  .no-data {
    text-align: center;
    font-style: italic;
    color: var(--dark);
    margin-top: 15px;
    padding: 15px;
    background: white;
    border-radius: var(--radius);
    border: 2px dashed #E5E7EB;
    font-size: 14px;
  }

  .red-flags-column { max-width: 120px; font-size: 11px; }
  .red-flag-tag, .green-flag-tag {
    display: inline-block;
    padding: 2px 6px;
    margin: 1px;
    border-radius: 4px;
    font-size: 10px;
  }
  .red-flag-tag { background-color: var(--danger); color: white; }
  .green-flag-tag { background-color: var(--success); color: white; }

  th:nth-child(1), td:nth-child(1) { max-width: 50px; white-space: nowrap; }
  th:nth-last-child(4), td:nth-last-child(4) { width: 55px; }
  th:nth-child(6), td:nth-child(6) { max-width: 180px; font-size: 11px; overflow: hidden; text-overflow: ellipsis; }
  th:nth-child(7), td:nth-child(7) { max-width: 120px; font-size: 11px; overflow: hidden; text-overflow: ellipsis; }

  .save-btn {
    display: block;
    width: 20%;
    margin: 8px auto 0;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
    background: var(--success);
    color: white;
    border: 2px solid var(--success);
    border-radius: var(--radius);
    box-shadow: 0 2px 10px rgba(168, 213, 168, 0.3);
    transition: var(--transition);
    cursor: pointer;
  }
  .save-btn:hover {
    background: var(--success-dark);
    border-color: var(--success-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(168, 213, 168, 0.4);
  }
</style>
</head>
<body>
 <h1>Trading Journal</h1>
 
 <div class="nav-buttons">
 <button class="nav-button active" onclick="showSection('daily')">Daily Entry</button>
 <button class="nav-button" onclick="showSection('weekly')">Trading History</button>
 <button class="nav-button" id="saveTopBtn" style="background: var(--success); color: white; border-color: var(--success);" onclick="saveEntry()">Save</button>
 <button class="nav-button" id="exportBtn" style="display: none; background: var(--success); color: white; border-color: var(--success);" onclick="exportToCSV()">Export CSV</button> 
 </div>

 <div id="daily" class="section active">
 <form id="dailyForm">
 
 <!-- Monthly Goal Tracker -->
 <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid var(--primary); border-radius: var(--radius); padding: 15px; margin-bottom: 20px; box-shadow: var(--shadow);">
 <div style="text-align: center; margin-bottom: 10px;">
 <label style="font-size: 14px; font-weight: 600; color: var(--primary-text); display: block; margin-bottom: 8px;">ğŸ¯ Monthly Goal</label>
 <input type="text" id="goalText" placeholder="e.g., Complete 5 trades with >2R" 
 style="text-align: center; font-size: 14px; padding: 8px; width: 100%; max-width: 400px; border: 2px solid #E5E7EB; border-radius: 8px;"
 onchange="saveGoal()">
 </div>
 <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 10px;">
 <input type="number" id="goalCurrent" min="0" value="0" 
 style="width: 60px; text-align: center; font-size: 16px; font-weight: 600; padding: 6px; border: 2px solid #E5E7EB; border-radius: 8px;"
 onchange="saveGoal()">
 <span style="font-size: 18px; font-weight: 600; color: var(--dark);">/</span>
 <input type="number" id="goalTarget" min="1" value="5" 
 style="width: 60px; text-align: center; font-size: 16px; font-weight: 600; padding: 6px; border: 2px solid #E5E7EB; border-radius: 8px;"
 onchange="saveGoal()">
 <span id="goalPercent" style="font-size: 14px; font-weight: 600; color: var(--primary-text); margin-left: 5px;">(0%)</span>
 </div>
 <div style="background: white; border-radius: 10px; height: 24px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
 <div id="goalProgressBar" style="height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%); width: 0%; transition: width 0.5s ease, background 0.3s ease; border-radius: 10px;"></div>
 </div>
 <div id="goalMessage" style="text-align: center; margin-top: 8px; font-size: 13px; font-weight: 500; min-height: 20px;"></div>
 </div>
 
 <!-- Compact layout: Date and Market on same line -->
 <div style="display: flex; gap: 10px; margin: 12px 0;">
 <div class="question" style="margin: 0; flex: 0 0 180px;">
 <label for="date">Date:</label>
 <input type="date" id="date" name="date">
 </div>
 <div class="question" style="margin: 0; flex: 1;">
 <label for="market_timeframe">Market & Timeframe:</label>
 <input type="text" id="market_timeframe" name="market_timeframe" placeholder="eg. HK, USD/JPY - 1H, 4H, Daily...">
 </div>
 </div>
 <div id="market-conditions-container"></div>

 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>â° TIMING & TRIGGER</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Entry Quality & Timing Score</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('timing', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('timing', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('timing', 1)">âœ”ï¸</button>
 </div>
 </div>
 <div id="timing-dropdown-container"></div>
 </div>
 
 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>âš ï¸ RISK MANAGEMENT</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Risk Control & Discipline</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('risk', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('risk', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('risk', 1)">âœ”ï¸</button>
 </div>
 </div>
 <div id="risk-dropdown-container"></div>
 
 <div class="question">
 <label for="risk_percent">Risk %:</label>
 <input type="number" step="0.1" placeholder="1.0%" id="risk_percent" value="1.0">
 </div>
 </div>
 
 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>ğŸ¯ ANALYSIS & SETUP</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Setup Quality & Analysis</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('analysis', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('analysis', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('analysis', 1)">âœ”ï¸</button>
 </div>
 </div>
 <div id="analysis-dropdown-container"></div>
 <div id="setup-dropdown-container"></div>
 
 <div class="question"> 
 <label for="setup_details">Setup Details (optional):</label>
 <input type="text" id="setup_details" placeholder="e.g., hanging man, at 1.2500 resistance...">
 </div>
 </div>

 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>ğŸ§  DISCIPLINE & PSYCHOLOGY</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Mental State & Discipline</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('discipline', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('discipline', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('discipline', 1)">âœ”ï¸</button>
 </div>
 </div>
 <div id="discipline-dropdown-container"></div>
 </div>
 
 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>ğŸšª EXIT STRATEGY</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Exit Timing & Execution</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('exit', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('exit', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('exit', 1)">âœ”ï¸</button>
 </div>
 </div>
 <div id="exit-dropdown-container"></div>
 </div>
 
 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>ğŸ’° RESULTS & REWARD</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="rating-question">
 <label>Risk/Reward Outcome</label>
 <div class="rating-container">
 <button type="button" class="emoji-btn" onclick="setRating('results', -1)">âŒ</button>
 <button type="button" class="emoji-btn" onclick="setRating('results', 0)">âšª</button>
 <button type="button" class="emoji-btn" onclick="setRating('results', 1)">âœ”ï¸</button>
 </div>
 </div>
 
 <div class="question">
 <label for="r_multiple">R value</label>
 <input type="number" step="0.1" placeholder="+5.0 or -1.0" id="r_multiple" value="1.0">
 </div>
 </div>

 <div class="section-header collapsible positive" onclick="toggleMainSection('green-flags')">
 <span>âœ”ï¸ GREEN TICKS - What I Did Well</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content" id="green-flags-content">
 <div class="green-flag-container">
 <label style="text-align: center; color: var(--green-flag-dark); font-size: 14px; font-weight: 500;">Celebrate wins to build discipline & edge</label>
 <div class="green-flag-grid">
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('followed_plan')">
 <span class="icon">ğŸ“‹</span> Followed Plan
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('premarket_analysis')">
 <span class="icon">ğŸ“Š</span> Pre-Market Analysis
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('waited_setup')">
 <span class="icon">â³</span> Waited for Setup
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('correct_timeframes')">
 <span class="icon">ğŸ“Š</span> Correct Timeframes
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('perfect_position_size')">
 <span class="icon">ğŸ¯</span> Perfect Position
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('quick_loss_cut')">
 <span class="icon">ğŸ›‘</span> Quick Loss Cut
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('hit_profit_target')">
 <span class="icon">ğŸ¯</span> Hit Profit Target
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('avoided_chasing')">
 <span class="icon">ğŸƒâ€â™‚ï¸</span> Avoided Chasing
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('emotional_control')">
 <span class="icon">ğŸ˜Œ</span> Emotional Control
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('documented_trades')">
 <span class="icon">ğŸ“</span> Documented Trades
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('post_trade_analysis')">
 <span class="icon">ğŸ¤”</span> Post-Trade Analysis
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('applied_lessons')">
 <span class="icon">ğŸ’¡</span> Applied Lessons
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('stuck_risk_limits')">
 <span class="icon">âš–ï¸</span> Stuck to Risk Limits
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('waited_confluence')">
 <span class="icon">ğŸ”„</span> Multi-Timeframe Confluence
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('reviewed_last_trade')">
 <span class="icon">ğŸ“–</span> Reviewed Last Trade
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('neutral_mindset')">
 <span class="icon">ğŸ§˜</span> Neutral Mindset (No Tilt)
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('documented_rationale')">
 <span class="icon">ğŸ“</span> Documented Rationale
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('exited_on_plan')">
 <span class="icon">ğŸ¯</span> Exited on Plan
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('adapted_conditions')">
 <span class="icon">ğŸ”„</span> Adapted to Conditions
 </button>
 <button type="button" class="green-flag-btn" onclick="toggleGreenFlag('celebrated_small_win')">
 <span class="icon">ğŸ‰</span> Celebrated Small Win
 </button> 
 </div>
 </div>
 </div>

 <div class="section-header collapsible danger" onclick="toggleMainSection('red-flags')">
 <span>ğŸš© RED FLAGS</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content" id="red-flags-content">
 <div class="red-flag-container">
 <label style="text-align: center; color: var(--red-flag-dark); font-size: 14px; font-weight: 500;">Flag risks to break bad habits & protect capital</label>
 <div class="red-flag-grid">
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('revenge')">
 <span class="icon">ğŸ˜¡</span> Revenge Trading
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('overtrading')">
 <span class="icon">ğŸ”„</span> Overtrading
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('fomo')">
 <span class="icon">ğŸ˜°</span> FOMO Entry
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('moved_stop')">
 <span class="icon">ğŸ“</span> Moved Stop Loss
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('added_loser')">
 <span class="icon">â•</span> Added to Loser
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('no_plan')">
 <span class="icon">â“</span> No Trading Plan
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('ignored_risk')">
 <span class="icon">âš ï¸</span> Ignored Risk Rules
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('trader_error')">
 <span class="icon">ğŸ’¢</span> Trader error
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('news_trade')">
 <span class="icon">ğŸ“°</span> News Reaction Trade
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('hope_hold')">
 <span class="icon">ğŸ¤</span> Hope & Hold
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('early_exit')">
 <span class="icon">ğŸƒ</span> Early Exit (Fear)
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('herd_behavior')">
 <span class="icon">ğŸ‘¥</span> Herd Behavior
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('loss_aversion')">
 <span class="icon">ğŸ“‰</span> Held Loser
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('overconfidence')">
 <span class="icon">ğŸ˜</span> Overconfident
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('confirmation_bias')">
 <span class="icon">ğŸ”</span> Confirmation Bias
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('illusion_control')">
 <span class="icon">ğŸ®</span> Illusion of Control
 </button>
 <button type="button" class="red-flag-btn" onclick="toggleRedFlag('social_influence')">
 <span class="icon">ğŸ“±</span> Social Impulse
 </button> 
 </div>
 </div>
 </div>

 <div class="section-header collapsible" onclick="toggleSection(this)">
 <span>ğŸ’¡ KEY TAKEAWAY</span>
 <span class="arrow">â–¼</span>
 </div>
 <div class="collapsible-content">
 <div class="question">
 <label for="key_takeaway">Key lesson learned:</label>
 <textarea id="key_takeaway" placeholder="What's the most important lesson from today's trading?"></textarea>
 </div>
 </div>
 
 <div style="text-align: center; margin-top: 20px;">
 <button type="button" class="save-btn" onclick="saveEntry()">SAVE Day Entry</button>
 </div>

 </form>
 </div>
 
 <!-- Weekly Review Section -->
 <div id="weekly" class="section">
 <!-- Date Range Filter Buttons -->
 <div class="date-filter-container">
 <button class="filter-btn timeframe-btn active" onclick="filterWeeklyData('last30')">Last 30 Days</button>
 <button class="filter-btn timeframe-btn" onclick="filterWeeklyData('thisWeek')">This Week</button>
 <button class="filter-btn timeframe-btn" onclick="filterWeeklyData('all')">All Time</button>
 </div>
 
 <!-- Column Visibility Toggles -->
 <div class="section-header" style="margin-top: 20px;">Column Visibility</div>
 <div class="date-filter-container" style="margin-bottom: 15px;">
 <button class="filter-btn column-btn" id="toggle-timing" onclick="toggleColumn('timing')">T - Timing</button>
 <button class="filter-btn column-btn" id="toggle-risk" onclick="toggleColumn('risk')">R - Risk</button>
 <button class="filter-btn column-btn" id="toggle-analysis" onclick="toggleColumn('analysis')">A - Analysis</button>
 <button class="filter-btn column-btn" id="toggle-discipline" onclick="toggleColumn('discipline')">D - Discipline</button>
 <button class="filter-btn column-btn" id="toggle-exit" onclick="toggleColumn('exit')">E - Exit</button>
 <button class="filter-btn column-btn" id="toggle-results" onclick="toggleColumn('results')">R - Results</button>
 </div>
 <div class="date-filter-container" style="margin-bottom: 15px;">
 <button class="filter-btn column-btn" id="toggle-setup" onclick="toggleColumn('setup')">Setup</button>
 <button class="filter-btn column-btn" id="toggle-market" onclick="toggleColumn('market')">Market</button>
 <button class="filter-btn column-btn" id="toggle-rvalue" onclick="toggleColumn('rvalue')">R value</button>
 <button class="filter-btn column-btn active" id="toggle-greenflags" onclick="toggleColumn('greenflags')">Green Flags</button>
 <button class="filter-btn column-btn active" id="toggle-redflags" onclick="toggleColumn('redflags')">Red Flags</button>
 <button class="filter-btn column-btn" id="toggle-takeaway" onclick="toggleColumn('takeaway')">Takeaway</button>
 </div>
 
 <div id="weeklyTable"></div>
 </div>

 <script>
 // Helper to get local YYYY-MM-DD string consistently (fixes timezone bug)
 function getLocalDateString() {
 const now = new Date();
 const year = now.getFullYear();
 const month = String(now.getMonth() + 1).padStart(2, '0');
 const day = String(now.getDate()).padStart(2, '0');
 return `${year}-${month}-${day}`;
 }

 // Config for T.R.A.D.E.R text dropdowns
 const traderDropdowns = [
 { id: 'market_conditions', label: 'Market Conditions', category: 'market', options: [
 { value: '', text: 'Select Condition' },
 { value: 'strong_uptrend', text: 'ğŸ“ˆ Strong Uptrend' },
 { value: 'strong_downtrend', text: 'ğŸ“‰ Strong Downtrend' },
 { value: 'ranging_sideways', text: 'â†”ï¸ Ranging/Sideways' },
 { value: 'high_volatility', text: 'âš¡ High Volatility' },
 { value: 'low_volatility', text: 'ğŸ˜´ Low Volatility' }
 ] },
 { id: 'timing_dropdown', label: 'Timing Assessment', category: 'timing', options: [
 { value: '', text: 'Select...' },
 { value: 'Too early', text: 'Too early' },
 { value: 'Perfect timing', text: 'Perfect timing' },
 { value: 'Missed setup', text: 'Missed setup' },
 { value: 'Late', text: 'Late' }
 ] },
 { id: 'risk_dropdown', label: 'Risk Assessment', category: 'risk', options: [
 { value: '', text: 'Select...' },
 { value: 'Small risk', text: 'Small risk' },
 { value: 'Position too big', text: 'Position too big' },
 { value: 'Just right', text: 'Just right' },
 ] },
 { id: 'analysis_quality_dropdown', label: 'Setup Quality', category: 'analysis_quality', options: [
 { value: '', text: 'Select...' },
 { value: 'Perfect recognition', text: 'Perfect recognition' },
 { value: 'Forced trade', text: 'Forced trade' },
 { value: 'Missed it', text: 'Missed it' }
 ] },
 { id: 'setup_used_dropdown', label: 'Setup Used', category: 'setup', options: [
 { value: '', text: 'Select...' },
 { value: 'Head & Shoulders', text: 'ğŸ”ï¸ Head & Shoulders' },
 { value: 'Double Top', text: 'â›°ï¸ Double Top' },
 { value: 'MA Cross', text: 'ğŸ“Š MA Cross' },
 { value: 'Support/Resistance', text: 'â‡… Support/Resistance' },
 { value: 'Breakout - 2nd leg', text: 'ğŸ’¥ Breakout - 2nd leg' },
 { value: 'Pattern Breakout', text: 'ğŸ’¥ Pattern Breakout' },
 { value: 'Opening Breakout', text: 'ğŸŒ… Opening Breakout' },
 { value: 'Cup & Handle', text: 'â˜• Cup & Handle' },
 { value: 'RSI Overbought/Oversold', text: 'ğŸ“ˆğŸ“‰ RSI Overbought/Oversold' },
 { value: '3 Indians', text: 'ğŸ¹ 3 Indians' },
 { value: 'Pivot Points', text: 'ğŸ”ƒ Pivot Points' },
 { value: 'Candlestick Pattern', text: 'ğŸ•¯ï¸ Candlestick Pattern' }
 ] },
 { id: 'discipline_dropdown', label: 'Emotional State', category: 'discipline', options: [
 { value: '', text: 'Select...' },
 { value: 'calm', text: 'ğŸ˜Œ Calm' },
 { value: 'excited', text: 'ğŸ˜ƒ Excited' },
 { value: 'hesitant', text: 'ğŸ˜• Hesitant' },
 { value: 'frustrated', text: 'ğŸ˜¤ Frustrated' },
 { value: 'overconfident', text: 'ğŸ˜ Overconfident' },
 { value: 'revenge', text: 'ğŸ˜¡ Revenge Trading' },
 { value: 'fomo', text: 'ğŸ˜° FOMO' },
 { value: 'bored', text: 'ğŸ˜‘ Bored/Overtrading' },
 { value: 'worked_psychology', text: 'ğŸ§‘â€ğŸ« Worked on my psychology' }
 ] },
 { id: 'exit_dropdown', label: 'Exit Assessment', category: 'exit', options: [
 { value: '', text: 'Select...' },
 { value: 'Stop Hit', text: 'Stop Hit' },
 { value: 'Trailing Stop Hit', text: 'Trailing Stop Hit' },
 { value: 'Profit Target Reached', text: 'Profit Target Reached' },
 { value: 'Fearful Early Exit', text: 'Fearful Early Exit' },
 { value: 'Let Winners Run', text: 'Let Winners Run' },
 { value: 'Held Too Long', text: 'Held Too Long' }
 ] }
 ];

 // Initialize scores with default values (0 = middle of -1, 0, 1 scale)
 let scores = {
 timing: 0,
 risk: 0,
 analysis: 0,
 discipline: 0,
 exit: 0,
 results: 0
 };

 // Initialize red flags tracking
 let redFlags = new Set();
 
 // Initialize green flags tracking
 let greenFlags = new Set();

 // Function to format date as "Sep 25" instead of "2025-09-25"
 function formatDateShort(dateString) {
 const date = new Date(dateString);
 const options = { month: 'short', day: 'numeric' };
 return date.toLocaleDateString('en-US', options);
 }

 // Generate HTML for all T.R.A.D.E.R dropdowns (now per-section)
 function generateTraderDropdowns() {
 traderDropdowns.forEach(config => {
 let containerId = `${config.category}-dropdown-container`;
 if (config.category === 'market') containerId = 'market-conditions-container';
 const container = document.getElementById(containerId);
 if (!container) return; // Skip if placeholder missing

 let html = `
 <div class="question">
 <label for="${config.id}">${config.label}:</label>
 <select id="${config.id}">
 ${config.options.map(opt => `<option value="${opt.value}">${opt.text}</option>`).join('')}
 </select>
 </div>
 `;
 container.innerHTML = html;
 });
 }

// Load entry for any date
function loadEntry(date) {
    // Regenerate dropdowns first to ensure they exist
    generateTraderDropdowns();
    
    // Always clear flags on date load for clean state
    greenFlags.clear();
    redFlags.clear();
    // Clear all flag buttons visually
    document.querySelectorAll('.green-flag-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.red-flag-btn').forEach(btn => btn.classList.remove('active'));
    
    const entries = JSON.parse(localStorage.getItem('tradingEntries')) || [];
    const entry = entries.find(e => e.date === date);
    
    if (entry) {
        // Scores & buttons
        if (entry.scores) {
            Object.keys(entry.scores).forEach(category => {
                scores[category] = entry.scores[category];
                updateRatingDisplay(category, entry.scores[category]);
            });
        }
        
        // Basic fields
        document.getElementById('market_timeframe').value = entry.marketTimeframe || '';
        document.getElementById('risk_percent').value = entry.riskPercent || '1.0';
        document.getElementById('setup_details').value = entry.setupDetails || '';
        document.getElementById('r_multiple').value = entry.rMultiple || '1.0';
        document.getElementById('key_takeaway').value = entry.keyTakeaway || '';
        
        // Dropdowns (now safe since generated)
        if (entry.traderTexts) {
            Object.keys(entry.traderTexts).forEach(category => {
                const dropdownId = traderDropdowns.find(config => config.category === category)?.id;
                if (dropdownId) {
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) dropdown.value = entry.traderTexts[category];
                }
            });
        }
        if (entry.setupUsed) document.getElementById('setup_used_dropdown').value = entry.setupUsed;
        if (entry.emotionalState) document.getElementById('discipline_dropdown').value = entry.emotionalState;
        if (entry.marketConditions) document.getElementById('market_conditions').value = entry.marketConditions;
        
        // Re-apply flags from entry
        if (entry.greenFlags) {
            entry.greenFlags.forEach(flag => {
                greenFlags.add(flag);
                const button = document.querySelector(`[onclick="toggleGreenFlag('${flag}')"]`);
                if (button) button.classList.add('active');
            });
        }
        if (entry.redFlags) {
            entry.redFlags.forEach(flag => {
                redFlags.add(flag);
                const button = document.querySelector(`[onclick="toggleRedFlag('${flag}')"]`);
                if (button) button.classList.add('active');
            });
        }
    } else {
        // Clear form if no entry (manually, to preserve date)
        document.getElementById('market_timeframe').value = '';
        document.getElementById('risk_percent').value = '1.0';
        document.getElementById('setup_details').value = '';
        document.getElementById('r_multiple').value = '1.0';
        document.getElementById('key_takeaway').value = '';
        
        // Clear dropdowns manually
        traderDropdowns.forEach(config => {
            const dropdown = document.getElementById(config.id);
            if (dropdown) dropdown.value = '';
        });
        
        Object.keys(scores).forEach(category => {
            scores[category] = 0;
            updateRatingDisplay(category, 0);
        });
        // Flags already cleared above
        
        // Do NOT reset the full form to avoid clearing the date input
    }
    
    // Refresh weekly table
    displayWeeklyData();
}

 // Function to set rating and update display
 function setRating(category, rating) {
 scores[category] = rating;
 updateRatingDisplay(category, rating);
 }
 
 // Function to update rating button display
 function updateRatingDisplay(category, rating) {
 const buttons = document.querySelectorAll(`[onclick*="setRating('${category}'"]`);
 buttons.forEach((btn) => {
 const onclickAttr = btn.getAttribute('onclick');
 const ratingMatch = onclickAttr.match(/setRating\('.*?',\s*(-?\d+)\)/);
 
 if (ratingMatch) {
 const btnRating = parseInt(ratingMatch[1]);
 if (btnRating === rating) {
 btn.classList.add('selected');
 } else {
 btn.classList.remove('selected');
 }
 }
 });
 }

 // Function to toggle green flag buttons
 function toggleGreenFlag(flagName) {
 const button = document.querySelector(`[onclick="toggleGreenFlag('${flagName}')"]`);
 
 if (greenFlags.has(flagName)) {
 greenFlags.delete(flagName);
 button.classList.remove('active');
 } else {
 greenFlags.add(flagName);
 button.classList.add('active');
 }
 }
 
 // Function to toggle red flag buttons
 function toggleRedFlag(flagName) {
 const button = document.querySelector(`[onclick="toggleRedFlag('${flagName}')"]`);
 
 if (redFlags.has(flagName)) {
 redFlags.delete(flagName);
 button.classList.remove('active');
 } else {
 redFlags.add(flagName);
 button.classList.add('active');
 }
 }

 // Function to toggle main sections (green flags and red flags)
 function toggleMainSection(sectionName) {
 const header = document.querySelector(`[onclick="toggleMainSection('${sectionName}')"]`);
 const content = document.getElementById(`${sectionName}-content`);
 
 if (content.classList.contains('expanded')) {
 content.classList.remove('expanded');
 header.classList.remove('expanded');
 } else {
 content.classList.add('expanded');
 header.classList.add('expanded');
 }
 }

 // Function to toggle generic collapsible sections (T.R.A.D.E.R sections, Key Takeaway)
 function toggleSection(headerElement) {
 const content = headerElement.nextElementSibling;
 
 if (content.classList.contains('expanded')) {
 content.classList.remove('expanded');
 headerElement.classList.remove('expanded');
 } else {
 content.classList.add('expanded');
 headerElement.classList.add('expanded');
 }
 }

 // Function to switch between Daily and Weekly sections
 function showSection(sectionName) {
 const sections = document.querySelectorAll('.section');
 sections.forEach(section => section.classList.remove('active'));
 
 const navButtons = document.querySelectorAll('.nav-button');
 navButtons.forEach(button => button.classList.remove('active'));
 
 document.getElementById(sectionName).classList.add('active');
 
 event.target.classList.add('active');
 
 if (sectionName === 'weekly') {
 displayWeeklyData();
 document.getElementById('exportBtn').style.display =
