import { useState } from 'react';

export default function TaoTeChingDivination() {
  const [lines, setLines] = useState([null, null, null, null]);
  const [verseNumber, setVerseNumber] = useState(null);
  const [history, setHistory] = useState([]);

  const generateDivination = () => {
    // Generate 4 random lines: 0 = solid (yang), 1 = broken (yin), 2 = dashed (old yin)
    const newLines = [
      Math.floor(Math.random() * 3),
      Math.floor(Math.random() * 3),
      Math.floor(Math.random() * 3),
      Math.floor(Math.random() * 3)
    ];
    setLines(newLines);

    // Convert base-3 to decimal (0-80), then map to verse (1-81)
    const base3Value = newLines.reduce((acc, val, idx) => {
      return acc + (val * Math.pow(3, 3 - idx));
    }, 0);

    const verse = base3Value + 1;
    
    setVerseNumber(verse);
    setHistory([...history, verse]);
  };

  const reset = () => {
    setLines([null, null, null, null]);
    setVerseNumber(null);
  };

  const renderLine = (lineType) => {
    const lineStyle = {
      height: '12px',
      backgroundColor: 'white',
      display: 'inline-block'
    };

    if (lineType === null) {
      return (
        <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
          <div style={{ ...lineStyle, width: '24px' }}></div>
          <div style={{ ...lineStyle, width: '24px' }}></div>
          <div style={{ ...lineStyle, width: '24px' }}></div>
        </div>
      );
    } else if (lineType === 0) {
      // Solid line
      return <div style={{ ...lineStyle, width: '80px', marginBottom: '8px' }}></div>;
    } else if (lineType === 1) {
      // Broken line (two segments)
      return (
        <div style={{ display: 'flex', gap: '16px', justifyContent: 'center', marginBottom: '8px' }}>
          <div style={{ ...lineStyle, width: '32px' }}></div>
          <div style={{ ...lineStyle, width: '32px' }}></div>
        </div>
      );
    } else {
      // Dashed line (three segments)
      return (
        <div style={{ display: 'flex', gap: '8px', justifyContent: 'center', marginBottom: '8px' }}>
          <div style={{ ...lineStyle, width: '20px' }}></div>
          <div style={{ ...lineStyle, width: '20px' }}></div>
          <div style={{ ...lineStyle, width: '20px' }}></div>
        </div>
      );
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8">
      <div className="max-w-md mx-auto">
        {/* Title */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold text-white mb-2">â˜¯</h1>
          <h2 className="text-3xl font-bold text-white mb-2">Tao Te Ching</h2>
          <p className="text-slate-300">I Ching Verse Selector</p>
        </div>

        {/* Card */}
        <div className="bg-slate-700 rounded-lg p-8 shadow-2xl border border-slate-600">
          
          {/* Yin/Yang Lines Display */}
          <div className="mb-8 flex flex-col items-center" style={{lineHeight: '0.2'}}>
            {lines.map((line, idx) => (
              <div key={idx} className="flex justify-center">
                {renderLine(line)}
              </div>
            ))}
          </div>

          {/* Verse Number Display */}
          {verseNumber && (
            <div className="text-center mb-8 p-4 bg-slate-600 rounded">
              <p className="text-slate-300 text-sm mb-1">Your Verse</p>
              <p className="text-5xl font-bold text-yellow-400">Verse {verseNumber}</p>
            </div>
          )}

          {/* Instructions */}
          {!verseNumber && (
            <div className="text-center mb-8 p-4 bg-slate-600 rounded">
              <p className="text-slate-300 text-sm">
                Click "Generate" to cast your divination and receive a verse for meditation
              </p>
            </div>
          )}

          {/* Buttons */}
          <div className="flex gap-3 mb-6">
            <button
              onClick={generateDivination}
              className="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded transition"
            >
              Generate
            </button>
            <button
              onClick={reset}
              className="flex-1 bg-slate-500 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded transition"
            >
              Reset
            </button>
          </div>


        </div>

        {/* History */}
        {history.length > 0 && (
          <div className="mt-8 bg-slate-700 rounded-lg p-6 border border-slate-600">
            <h3 className="text-white font-bold mb-3">Recent Verses</h3>
            <div className="flex flex-wrap gap-2">
              {history.map((verse, idx) => (
                <div
                  key={idx}
                  className="bg-slate-600 text-yellow-400 font-bold py-1 px-3 rounded text-sm"
                >
                  {verse}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Footer Note */}
        <p className="text-center text-slate-500 text-xs mt-8">
          Use this to randomly select a verse from the Tao Te Ching (1-81) for your daily study
        </p>
      </div>
    </div>
  );
}
